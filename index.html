<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</title>
  <style>
    :root { --bg:#0f1220; --panel:#161a2b; --accent:#6ee7ff; --muted:#8b94a7; --win:#72eecb; }
    * { box-sizing: border-box }
    body {
      margin:0; font:16px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:#f7f8ff; background: radial-gradient(1200px 600px at 20% -10%, #1a1f36 0, #0f1220 60%);
      display:grid; place-items:center; min-height:100dvh; padding:24px;
    }
    .app {
      width:min(92vw, 680px);
      background:linear-gradient(180deg, #151a2a 0, #0f1220 100%);
      border:1px solid #212847; border-radius:20px; padding:20px; box-shadow:0 10px 40px rgba(0,0,0,.45);
    }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px }
    h1 { font-size:20px; margin:0 }
    .controls { display:flex; gap:8px; flex-wrap:wrap }
    select, button {
      background:#12162a; color:#e7ecff; border:1px solid #263056; border-radius:12px; padding:10px 12px; cursor:pointer;
      transition:.15s transform,.15s background,.15s border;
    }
    select:focus, button:focus { outline:2px solid #2e7de9; outline-offset:2px }
    button:hover, select:hover { background:#182042 }
    button:active { transform: translateY(1px) }
    .status {
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      background:#12162a; border:1px solid #263056; border-radius:14px; padding:10px 12px; margin:12px 0 16px;
    }
    .badge { font-weight:700; letter-spacing:.4px; color:#0fe; }
    .board {
      display:grid; grid-template-columns:repeat(3,1fr); gap:10px;
      background:#10142a; border-radius:18px; padding:10px; border:1px solid #1e2546;
    }
    .cell {
      aspect-ratio:1/1; display:grid; place-items:center; font-size:clamp(38px, 10vw, 56px);
      background:#0f1328; border:1px solid #20284a; border-radius:16px; cursor:pointer;
      transition:.18s transform,.18s background,.18s border,.18s box-shadow;
      box-shadow: inset 0 0 0 0 rgba(110,231,255,.08);
      user-select:none;
    }
    .cell:hover { transform:translateY(-1px); background:#121736; border-color:#2a3563 }
    .cell.filled { cursor:not-allowed; opacity:.95 }
    .cell.won { background:#0f1f1a; border-color:#2f7; box-shadow:0 0 0 2px rgba(114,238,203,.25) inset }
    .legend { color:var(--muted); font-size:14px }
    .scores {
      display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;
    }
    .chip {
      background:#12162a; border:1px solid #263056; border-radius:999px; padding:6px 10px; font-size:14px;
    }
    footer { margin-top:16px; color:var(--muted); font-size:13px; text-align:center }
    .blink { animation:blink .9s linear infinite }
    @keyframes blink { 50% { opacity:.4 } }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>üéÆ –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</h1>
      <div class="controls">
        <select id="mode" title="–†–µ–∂–∏–º –∏–≥—Ä—ã">
          <option value="pvp">üë• –ò–≥—Ä–æ–∫ vs –ò–≥—Ä–æ–∫</option>
          <option value="easy">ü§ñ –ò–≥—Ä–æ–∫ vs –ò–ò (Easy)</option>
          <option value="hard" selected>üß† –ò–≥—Ä–æ–∫ vs –ò–ò (Hard)</option>
        </select>
        <button id="reset">–ù–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è</button>
        <button id="resetScores" title="–û–±–Ω—É–ª–∏—Ç—å —Å—á—ë—Ç">–û–±–Ω—É–ª–∏—Ç—å —Å—á—ë—Ç</button>
      </div>
    </header>

    <div class="status">
      <div>–•–æ–¥: <span id="turn" class="badge">X</span></div>
      <div id="message" class="legend">–ò–≥—Ä–æ–∫ X –Ω–∞—á–∏–Ω–∞–µ—Ç</div>
    </div>

    <div id="board" class="board" role="grid" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ 3 –Ω–∞ 3"></div>

    <div class="scores">
      <div class="chip">–ü–æ–±–µ–¥ X: <strong id="sx">0</strong></div>
      <div class="chip">–ü–æ–±–µ–¥ O: <strong id="so">0</strong></div>
      <div class="chip">–ù–∏—á—å–∏: <strong id="sd">0</strong></div>
    </div>

    <footer>–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞–∫. –í —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Ç–∏–≤ –ò–ò –≤—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ <b>X</b>.</footer>
  </div>

  <script>
    // --- Game state ---
    const boardEl = document.getElementById('board');
    const turnEl = document.getElementById('turn');
    const msgEl = document.getElementById('message');
    const modeEl = document.getElementById('mode');
    const resetBtn = document.getElementById('reset');
    const resetScoresBtn = document.getElementById('resetScores');
    const sxEl = document.getElementById('sx'), soEl = document.getElementById('so'), sdEl = document.getElementById('sd');

    const WINS = [
      [0,1,2],[3,4,5],[6,7,8], // rows
      [0,3,6],[1,4,7],[2,5,8], // cols
      [0,4,8],[2,4,6]          // diags
    ];

    let board, current, active, scores, lastWinLine;

    function initState() {
      board = Array(9).fill('');
      current = 'X';
      active = true;
      lastWinLine = null;
      msgEl.textContent = (modeEl.value === 'pvp') ? '–ò–≥—Ä–æ–∫ X –Ω–∞—á–∏–Ω–∞–µ—Ç' : '–í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ X';
      updateTurn();
      render();
    }
    function initScores() {
      scores = { X:0, O:0, D:0 };
      sxEl.textContent = soEl.textContent = sdEl.textContent = '0';
    }

    // --- Rendering ---
    function render() {
      boardEl.innerHTML = '';
      for (let i=0;i<9;i++) {
        const cell = document.createElement('button');
        cell.className = 'cell' + (board[i] ? ' filled' : '');
        cell.setAttribute('role','gridcell');
        cell.setAttribute('aria-label', `–ö–ª–µ—Ç–∫–∞ ${i+1} ${board[i]||'–ø—É—Å—Ç–æ'}`);
        cell.dataset.idx = i;
        cell.textContent = board[i];
        if (lastWinLine && lastWinLine.includes(i)) cell.classList.add('won');
        cell.addEventListener('click', onCellClick);
        boardEl.appendChild(cell);
      }
    }
    function updateTurn(text) {
      turnEl.textContent = current;
      if (text) msgEl.textContent = text;
    }

    // --- Game logic ---
    function onCellClick(e) {
      const i = +e.currentTarget.dataset.idx;
      if (!active || board[i]) return;

      move(i, current);
      const res = evaluate();
      if (res) return endRound(res);

      // AI move (player is X, AI is O)
      if (modeEl.value !== 'pvp' && active && current === 'O') {
        msgEl.textContent = '–•–æ–¥ –ò–ò‚Ä¶';
        turnEl.classList.add('blink');
        setTimeout(() => {
          const aiIndex = (modeEl.value === 'easy') ? aiEasy() : aiHard();
          move(aiIndex, 'O');
          const r2 = evaluate();
          turnEl.classList.remove('blink');
          if (r2) return endRound(r2);
          updateTurn('–í–∞—à —Ö–æ–¥');
        }, 180);
      }
    }

    function move(i, symbol) {
      board[i] = symbol;
      current = (symbol === 'X') ? 'O' : 'X';
      render();
      updateTurn();
    }

    function evaluate() {
      for (const line of WINS) {
        const [a,b,c] = line;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          lastWinLine = line;
          return board[a]; // 'X' or 'O'
        }
      }
      if (board.every(Boolean)) return 'D'; // draw
      return null;
    }

    function endRound(result) {
      active = false;
      if (result === 'D') {
        msgEl.textContent = '–ù–∏—á—å—è üôÉ';
        scores.D++; sdEl.textContent = scores.D;
      } else {
        msgEl.textContent = `–ü–æ–±–µ–¥–∞ ${result}! üéâ`;
        scores[result]++; (result==='X'?sxEl:soEl).textContent = scores[result];
      }
      render();
    }

    // --- AI ---
    function aiEasy() {
      const empty = board.map((v,i)=>v?null:i).filter(v=>v!==null);
      return empty[Math.floor(Math.random()*empty.length)];
    }

    function aiHard() {
      // Minimax: AI is 'O', human is 'X'
      const best = minimax(board.slice(), 'O', -Infinity, Infinity);
      return best.index;
    }

    function minimax(state, player, alpha, beta) {
      const winner = checkWinner(state);
      if (winner === 'O') return { score: +10 };
      if (winner === 'X') return { score: -10 };
      if (state.every(Boolean)) return { score: 0 };

      const moves = [];
      for (let i=0;i<9;i++) if (!state[i]) {
        state[i] = player;
        const next = minimax(state, player==='O'?'X':'O', alpha, beta);
        moves.push({ index:i, score: next.score });
        state[i] = '';
        if (player==='O') { // maximize
          alpha = Math.max(alpha, next.score);
          if (beta <= alpha) break;
        } else { // minimize
          beta = Math.min(beta, next.score);
          if (beta <= alpha) break;
        }
      }

      if (player==='O') {
        // choose max
        return moves.reduce((a,b)=> b.score>a.score ? b : a);
      } else {
        // choose min
        return moves.reduce((a,b)=> b.score<a.score ? b : a);
      }
    }

    function checkWinner(s) {
      for (const [a,b,c] of WINS) {
        if (s[a] && s[a]===s[b] && s[a]===s[c]) return s[a];
      }
      return null;
    }

    // --- Events & init ---
    modeEl.addEventListener('change', () => {
      initState();
    });
    resetBtn.addEventListener('click', () => initState());
    resetScoresBtn.addEventListener('click', () => { initScores(); initState(); });

    initScores();
    initState();
  </script>
</body>
</html>
